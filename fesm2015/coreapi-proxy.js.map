{"version":3,"file":"coreapi-proxy.js","sources":["ng://coreapi-proxy/lib/config.service.ts","ng://coreapi-proxy/lib/global.state.ts","ng://coreapi-proxy/lib/coreapi-proxy.service.ts","ng://coreapi-proxy/lib/coreapi-proxy.module.ts","ng://coreapi-proxy/public-api.ts","ng://coreapi-proxy/coreapi-proxy.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\n\n@Injectable()\nexport class ConfigService {\n  private data: Object = null;\n\n  set(data) {\n    this.data = data;\n  }\n\n  get(key: any) {\n    return this.data[key];\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Subject } from 'rxjs/Subject';\n\n@Injectable()\nexport class GlobalState {\n\n  private _data = new Subject<Object>();\n  private _dataStream$ = this._data.asObservable();\n\n  private _subscriptions: Map<string, Array<Function>> = new Map<string, Array<Function>>();\n\n  constructor() {\n    this._dataStream$.subscribe((data) => this._onEvent(data));\n  }\n\n  notifyDataChanged(event, value, force = false) {\n    const current = this._data[event];\n    if (current !== value || force) {\n      this._data[event] = value;\n\n      this._data.next({\n        event: event,\n        data: this._data[event],\n      });\n    }\n  }\n\n  subscribe(event: string, callback: Function) {\n    const subscribers = this._subscriptions.get(event) || [];\n    if (subscribers.indexOf(callback) < 0) {\n      subscribers.push(callback);\n    }\n    this._subscriptions.set(event, subscribers);\n  }\n\n  _onEvent(data: any) {\n    const subscribers = this._subscriptions.get(data['event']) || [];\n    console.log(subscribers);\n    subscribers.forEach((callback) => {\n      callback.call(null, data['data']);\n    });\n  }\n}\n","import { Injectable, Injector } from '@angular/core';\nimport { LocalStorageService } from 'angular-web-storage';\nimport { Promise } from 'bluebird';\nimport * as coreapi from 'coreapi';\nimport { Observable } from 'rxjs/Observable';\n\nimport { ConfigService } from \"./config.service\";\nimport { GlobalState } from './global.state';\n\nexport interface ActionParams {\n  Params?: object,\n  ExtraParams?: object\n}\n\n@Injectable()\nexport class CoreAPIBaseService {\n  constructor(private client: CoreAPIClient) {\n  }\n\n  action(keys: Array<string>, params = {}, extraParams = {}) {\n    const actionParams: ActionParams = { Params: params, ExtraParams: extraParams };\n    return this.client.action(keys, actionParams);\n  }\n}\n\nexport interface ICoreAPIConfig {\n  globalHeaders: Array<Object>;\n  headerName: string;\n  headerPrefix: string;\n  noJwtError: boolean;\n  noClientCheck: boolean;\n  noTokenScheme?: boolean;\n  tokenGetter: () => string | Promise<string>;\n  tokenName: string;\n}\n\nexport interface ICoreAPIConfigOptional {\n  headerName?: string;\n  headerPrefix?: string;\n  tokenName?: string;\n  tokenGetter?: () => string | Promise<string>;\n  noJwtError?: boolean;\n  noClientCheck?: boolean;\n  globalHeaders?: Array<Object>;\n  noTokenScheme?: boolean;\n}\n\nexport class CoreAPIConfigConsts {\n  public static DEFAULT_HEADER_NAME = 'Authorization';\n  public static HEADER_PREFIX_BEARER = 'JWT';\n  public static DEFAULT_TOKEN_NAME = 'token';\n}\n\nconst COREAPI_CONFIG_DEFAULTS: ICoreAPIConfig = {\n  headerName: CoreAPIConfigConsts.DEFAULT_HEADER_NAME,\n  headerPrefix: null,\n  tokenName: CoreAPIConfigConsts.DEFAULT_TOKEN_NAME,\n  tokenGetter: () =>\n    localStorage.getItem(COREAPI_CONFIG_DEFAULTS.tokenName) as string,\n  noJwtError: false,\n  noClientCheck: false,\n  globalHeaders: [],\n  noTokenScheme: false,\n};\n\n/**\n * Helper class to decode and find JWT expiration.\n */\n\nexport class JwtHelper {\n  public urlBase64Decode(str: string): string {\n    let output = str.replace(/-/g, '+').replace(/_/g, '/');\n    switch (output.length % 4) {\n      case 0: {\n        break;\n      }\n      case 2: {\n        output += '==';\n        break;\n      }\n      case 3: {\n        output += '=';\n        break;\n      }\n      default: {\n        throw new Error('Illegal base64url string!');\n      }\n    }\n    return this.b64DecodeUnicode(output);\n  }\n\n  public decodeToken(token: string): any {\n    const parts = token.split('.');\n\n    if (parts.length !== 3) {\n      throw new Error('JWT must have 3 parts');\n    }\n\n    const decoded = this.urlBase64Decode(parts[1]);\n    if (!decoded) {\n      throw new Error('Cannot decode the token');\n    }\n\n    return JSON.parse(decoded);\n  }\n\n  public getTokenExpirationDate(token: string): Date {\n    let decoded: any;\n    decoded = this.decodeToken(token);\n\n    if (!decoded.hasOwnProperty('exp')) {\n      return null;\n    }\n\n    const date = new Date(0); // The 0 here is the key, which sets the date to the epoch\n    date.setUTCSeconds(decoded.exp);\n\n    return date;\n  }\n\n  public isTokenExpired(token: string, offsetSeconds?: number): boolean {\n    const date = this.getTokenExpirationDate(token);\n    offsetSeconds = offsetSeconds || 0;\n\n    if (date == null) {\n      return false;\n    }\n\n    // Token expired?\n    return !(date.valueOf() > new Date().valueOf() + offsetSeconds * 1000);\n  }\n\n  // credits for decoder goes to https://github.com/atk\n  private b64decode(str: string): string {\n    const chars =\n      'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n    let output = '';\n\n    str = String(str).replace(/=+$/, '');\n\n    if (str.length % 4 === 1) {\n      throw new Error(\n        '\"atob\" failed: The string to be decoded is not correctly encoded.',\n      );\n    }\n\n    for (\n      // initialize result and counters\n      let bc = 0, bs: any, buffer: any, idx = 0;\n      // get next character\n      (buffer = str.charAt(idx++));\n      // character found in table? initialize bit storage and add its ascii value;\n      ~buffer &&\n      ((bs = bc % 4 ? bs * 64 + buffer : buffer),\n        // and if not first of each 4 characters,\n        // convert the first 8 bits to one ascii character\n      bc++ % 4)\n        ? (output += String.fromCharCode(255 & (bs >> ((-2 * bc) & 6))))\n        : 0\n    ) {\n      // try to find character in table (0-63, not found => -1)\n      buffer = chars.indexOf(buffer);\n    }\n    return output;\n  }\n\n  // https://developer.mozilla.org/en/docs/Web/API/WindowBase64/Base64_encoding_and_decoding#The_Unicode_Problem\n  private b64DecodeUnicode(str: any) {\n    return decodeURIComponent(\n      Array.prototype.map\n        .call(this.b64decode(str), (c: any) => {\n          return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n        })\n        .join(''),\n    );\n  }\n}\n\nconst injector = Injector.create({ providers: [{ provide: LocalStorageService }] });\nconst localStorageService = injector.get(LocalStorageService);\n\n/**\n * Checks for presence of token and that token hasn't expired.\n * For use with the @CanActivate router decorator and NgIf\n */\nexport function tokenNotExpired(\n  tokenName = CoreAPIConfigConsts.DEFAULT_TOKEN_NAME,\n  jwt?: string,\n): boolean {\n  const token: string = jwt || localStorageService.get(tokenName);\n  const jwtHelper = new JwtHelper();\n  return token != null && !jwtHelper.isTokenExpired(token);\n}\n\n/**\n * Sets up the authentication configuration.\n */\n\nexport class CoreAPIConfig {\n  _config: ICoreAPIConfig;\n\n  constructor(config?: ICoreAPIConfigOptional) {\n    config = config || {};\n    this._config = objectAssign({}, COREAPI_CONFIG_DEFAULTS, config);\n    if (this._config.headerPrefix) {\n      this._config.headerPrefix += ' ';\n    } else if (this._config.noTokenScheme) {\n      this._config.headerPrefix = '';\n    } else {\n      this._config.headerPrefix = CoreAPIConfigConsts.HEADER_PREFIX_BEARER;\n    }\n\n    if (config.tokenName && !config.tokenGetter) {\n      this._config.tokenGetter = () =>\n        localStorage.getItem(config.tokenName) as string;\n    }\n  }\n\n  public getConfig(): ICoreAPIConfig {\n    return this._config;\n  }\n}\n\n@Injectable()\nexport class CoreAPIClient {\n  public tokenStream: Observable<string>;\n\n  private coreAPIConfig: ICoreAPIConfig;\n  private _client: any;\n  private schema;\n  private fetchingSchema = false;\n\n  constructor(\n    private options: CoreAPIConfig,\n    private config: ConfigService,\n    private globalState: GlobalState,\n  ) {\n    this.coreAPIConfig = options.getConfig();\n\n    this.tokenStream = new Observable<string>((obs: any) => {\n      obs.next(this.coreAPIConfig.tokenGetter());\n    });\n    this.globalState.subscribe('user.logout', logout => {\n      this._client = null;\n      this.schema = null;\n    });\n    this.globalState.subscribe('user.tokenRefreshed', () => {\n      this._client = null;\n    });\n  }\n\n  get(url: string) {\n    return this.client.get(url);\n  }\n\n  sleep(ms) {\n    return new Promise((resolve, reject) => setTimeout(resolve, ms));\n  }\n\n  async waitSchema() {\n    for (let i = 0; i < 600; i++) {\n      await this.sleep(100);\n      if (this.schema) {\n        return;\n      }\n    }\n  }\n\n  getSchema() {\n    return new Promise((resolve, reject) => {\n      if (!this.schema) {\n        if (this.fetchingSchema) {\n          this.waitSchema()\n            .then(() => {\n              resolve(this.schema);\n            })\n            .catch(error => {\n              console.error(`Fetch schema timeout.`, error);\n              reject(error);\n            });\n        } else {\n          const url = this.config.get('schemaUrl');\n          this.fetchingSchema = true;\n          this.get(url)\n            .then(data => {\n              this.schema = data;\n              resolve(this.schema);\n              this.fetchingSchema = false;\n            })\n            .catch(error => {\n              console.error(`Fetch schema failed.`, error);\n              reject(error);\n              this.fetchingSchema = false;\n            });\n        }\n      } else {\n        resolve(this.schema);\n      }\n    });\n  }\n\n  action(\n    keys: Array<string>,\n    params: ActionParams = {},\n  ): Promise<any> {\n    this.globalState.notifyDataChanged('http.loading', true);\n\n    return new Promise((resolve, reject) => {\n      this.getSchema()\n        .then(doc => {\n          this.client\n            .action(doc, keys, params.Params, params.ExtraParams)\n            .then(data => {\n              this.globalState.notifyDataChanged('http.loading', false);\n              resolve(data);\n            })\n            .catch(error => {\n              let message = '';\n              if (Object.prototype.toString.call(error.content) === '[object Object]') {  // Whether it is an Objec object\n                message = error.content.detail;\n              } else {\n                message = error.content;\n              }\n\n              if (error.response.status === 401) {\n                this.globalState.notifyDataChanged('http.401', message);\n              } else if (error.response.status === 403) {\n                this.globalState.notifyDataChanged('http.403', message, true);\n              } else if (error.response.status === 500) {\n                this.globalState.notifyDataChanged('http.500', message, true);\n              } else if (error.response.status === 501) {\n                this.globalState.notifyDataChanged('http.501', message, true);\n              }\n\n              this.globalState.notifyDataChanged('http.loading', false);\n              reject(error);\n            });\n        })\n        .catch(error => {\n          console.error(`Request ${keys} failed.`, error);\n\n          this.globalState.notifyDataChanged('http.loading', false);\n          reject(error);\n        });\n    });\n  }\n\n  private get client() {\n    if (!this._client) {\n      const options = {\n        auth: new coreapi.auth.TokenAuthentication({\n          token: this.coreAPIConfig.tokenGetter(),\n          scheme: this.coreAPIConfig.headerPrefix,\n        }),\n      };\n      this._client = new coreapi.Client(options);\n    }\n\n    return this._client;\n  }\n}\n\nexport function coreAPIFactory(\n  config: ConfigService,\n  globalState: GlobalState,\n) {\n  const coreAPIConfig = {\n    headerName: CoreAPIConfigConsts.DEFAULT_HEADER_NAME,\n    headerPrefix: CoreAPIConfigConsts.HEADER_PREFIX_BEARER,\n    tokenName: CoreAPIConfigConsts.DEFAULT_TOKEN_NAME,\n    tokenGetter() {\n      return localStorageService.get(coreAPIConfig.tokenName);\n    },\n    globalHeaders: [{ 'Content-Type': 'application/json' }],\n    noJwtError: false,\n    noTokenScheme: false,\n  };\n  return new CoreAPIClient(\n    new CoreAPIConfig(coreAPIConfig),\n    config,\n    globalState,\n  );\n}\n\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\nconst propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val: any) {\n  if (val === null || val === undefined) {\n    throw new TypeError(\n      'Object.assign cannot be called with null or undefined',\n    );\n  }\n\n  return Object(val);\n}\n\nfunction objectAssign(target: any, ...source: any[]) {\n  let from: any;\n  let symbols: any;\n  const to = toObject(target);\n\n  for (let s = 1; s < arguments.length; s++) {\n    from = Object(arguments[s]);\n\n    for (const key in from) {\n      if (hasOwnProperty.call(from, key)) {\n        to[key] = from[key];\n      }\n    }\n\n    if ((<any>Object).getOwnPropertySymbols) {\n      symbols = (<any>Object).getOwnPropertySymbols(from);\n      for (let i = 0; i < symbols.length; i++) {\n        if (propIsEnumerable.call(from, symbols[i])) {\n          to[symbols[i]] = from[symbols[i]];\n        }\n      }\n    }\n  }\n  return to;\n}\n\nexport class CoreAPIClientHttpError extends Error {\n}\n","import { NgModule } from '@angular/core';\nimport { ConfigService } from './config.service';\nimport { GlobalState } from './global.state';\nimport { CoreAPIClient, CoreAPIBaseService, coreAPIFactory } from './coreapi-proxy.service';\n\n\n\n@NgModule({\n  declarations: [\n  ],\n  imports: [\n  ],\n  providers: [\n    ConfigService,\n    GlobalState,\n    CoreAPIBaseService,\n    {\n      provide: CoreAPIClient,\n      useFactory: coreAPIFactory,\n      deps: [ConfigService, GlobalState],\n    }\n  ],\n  exports: [\n  ]\n})\nexport class CoreapiProxyModule { }\n","/*\n * Public API Surface of coreapi-proxy\n */\n\nexport { CoreAPIBaseService, tokenNotExpired } from './lib/coreapi-proxy.service';\n\nexport * from './lib/config.service';\nexport * from './lib/global.state';\nexport * from './lib/coreapi-proxy.module';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n\nexport {CoreAPIClient as ɵb,CoreAPIConfig as ɵa,coreAPIFactory as ɵc} from './lib/coreapi-proxy.service';"],"names":["coreapi.auth","coreapi.Client"],"mappings":"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"}